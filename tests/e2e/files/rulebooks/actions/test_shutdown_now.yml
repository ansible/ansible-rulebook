---
- name: Ruleset 1
  hosts: all
  sources:
    - generic:
        event_delay: 1.5
        payload:
          - action: "long_running_playbook"
          - action: "send_msg"

  rules:
    - name: Start long-running playbook
      condition: event.action == "long_running_playbook"
      actions:
        - run_playbook:
            name: ./playbooks/long_running.yml
            extra_vars:
              pause_time: 30
        - debug:
            msg: "Parallel action triggered successfully"

    - name: Send message after shutdown
      condition: event.action == "send_msg"
      action:
        debug:
          msg: "This condition should not fire"


- name: Ruleset 2
  hosts: all
  sources:
    - generic:
        startup_delay: "{{ DEFAULT_STARTUP_DELAY }}"
        payload:
          - action: "trigger_shutdown"

  rules:
    - name: Shutdown
      condition: event.action == "trigger_shutdown"
      action:
        shutdown:
          kind: now
          message: "Shutdown triggered from Ruleset 2"
