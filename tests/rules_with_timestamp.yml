---
- name: Demo rules with time
  hosts: localhost
  sources:
    - timestamp:
  rules:
    - name: promote timestamp.unix_timestamp to current_time fact
      condition: event.timestamp.unix_timestamp is defined
      action:
        assert_fact:
          fact:
            current_time: "{{event.timestamp.unix_timestamp}}"
    - name: set the initial time
      condition:
        all:
          - events.time << event.current_time is defined
          - event.initial_time is not defined
      action:
        assert_fact:
          fact:
            initial_time: "{{events.time.current_time}}"
    - name: retract current_time fact
      condition: fact.current_time is defined
      action:
        retract_fact:
          fact:
            current_time: "{{event.current_time}}"
    - name: debug
      condition: fact.initial_time is defined
      action:
        debug:
    - name: shutdown
      condition:
        all:
          - facts.a << fact.initial_time is defined
          - fact.current_time >= facts.a.initial_time + 5
      action:
        shutdown:
